<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dijkstra's Algorithm Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .graph-container {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 16px;
            height: 380px;
            position: relative;
        }

        .node {
            position: absolute;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s;
            z-index: 10;
        }

        .node-label {
            font-size: 14px;
        }

        .node-dist {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 2px;
        }

        .node-idle {
            background: linear-gradient(135deg, #475569, #334155);
            border: 3px solid #64748b;
        }

        .node-source {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            border: 3px solid #86efac;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.6);
        }

        .node-current {
            background: linear-gradient(135deg, #f87171, #ef4444);
            border: 3px solid #fca5a5;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.7);
            transform: scale(1.1);
        }

        .node-queue {
            background: linear-gradient(135deg, #fcd34d, #f59e0b);
            border: 3px solid #fde68a;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        .node-relaxed {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            border: 3px solid #93c5fd;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .node-done {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            border: 3px solid #86efac;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }

        .edge {
            position: absolute;
            height: 3px;
            background: #475569;
            transform-origin: left center;
            z-index: 1;
            transition: all 0.3s;
        }

        .edge-weight {
            position: absolute;
            background: rgba(15, 23, 42, 0.9);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            color: #94a3b8;
            z-index: 5;
        }

        .edge-relaxed {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
            height: 4px;
        }

        .edge-shortest {
            background: linear-gradient(90deg, #22c55e, #4ade80);
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.6);
            height: 5px;
        }

        .dist-table {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        .dist-row {
            display: flex;
            gap: 8px;
            padding: 4px 8px;
            border-radius: 6px;
            margin-bottom: 2px;
        }

        .dist-row.current {
            background: rgba(239, 68, 68, 0.2);
        }

        .dist-node {
            width: 24px;
            font-weight: bold;
        }

        .dist-val {
            color: #4ade80;
        }

        .dist-inf {
            color: #64748b;
        }

        .code-panel {
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            line-height: 1.3;
        }

        .code-line {
            padding: 1px 4px;
            border-radius: 4px;
        }

        .code-line.active {
            background: rgba(34, 197, 94, 0.3);
            border-left: 2px solid #22c55e;
        }

        .code-line-number {
            color: #64748b;
            width: 16px;
            display: inline-block;
            text-align: right;
            margin-right: 6px;
        }

        .btn-control {
            padding: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-play {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .btn-pause {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn-step {
            background: rgba(71, 85, 105, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .btn-step:disabled {
            opacity: 0.4;
        }

        .metric {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 10px;
            padding: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 18px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #22c55e, #4ade80);
            cursor: pointer;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-ready {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }

        .status-running {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        .status-paused {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }

        .status-complete {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
        }
    </style>
</head>

<body class="text-white">
    <div class="container mx-auto p-4 max-w-7xl">
        <header class="mb-4">
            <a href="../index.html"
                class="inline-flex items-center gap-2 text-slate-400 hover:text-green-400 transition mb-2 text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Back to Home
            </a>
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center text-lg shadow-lg shadow-green-500/30">
                    üõ§Ô∏è</div>
                <div>
                    <h1
                        class="text-xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                        Dijkstra's Algorithm</h1>
                    <p class="text-slate-400 text-xs">Shortest Path ‚Ä¢ O((V+E) log V) ‚Ä¢ Priority Queue</p>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
            <div class="lg:col-span-4 space-y-3">
                <div class="glass-card rounded-xl p-3">
                    <h2 class="text-xs font-semibold mb-2 text-slate-300">Controls</h2>
                    <div class="mb-3">
                        <label class="text-xs text-slate-400">Source Node</label>
                        <select id="sourceNode"
                            class="w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-sm mt-1">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                    <button onclick="resetGraph()"
                        class="w-full bg-gradient-to-r from-slate-600 to-slate-700 py-2 rounded-lg font-semibold text-xs">Reset</button>
                </div>

                <div class="glass-card rounded-xl p-3">
                    <h2 class="text-xs font-semibold mb-2 text-slate-300">Playback</h2>
                    <div class="flex items-center justify-center gap-2 mb-3">
                        <button id="stepBackBtn" onclick="stepBack()" class="btn-control btn-step w-10 h-10" disabled>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0019 16V8a1 1 0 00-1.6-.8l-5.333 4zM4.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0011 16V8a1 1 0 00-1.6-.8l-5.334 4z" />
                            </svg>
                        </button>
                        <button id="playPauseBtn" onclick="togglePlayPause()" class="btn-control btn-play w-12 h-12">
                            <svg id="playIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                            <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" />
                            </svg>
                        </button>
                        <button id="stepForwardBtn" onclick="stepForward()" class="btn-control btn-step w-10 h-10"
                            disabled>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z" />
                            </svg>
                        </button>
                    </div>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="text-slate-400">Speed</span>
                        <span id="speedValue" class="text-green-400 font-mono">1x</span>
                    </div>
                    <input type="range" id="speedSlider" min="0.5" max="5" step="0.5" value="1"
                        class="slider w-full h-2 bg-slate-700 rounded-lg">
                    <div class="flex items-center justify-between mt-2 pt-2 border-t border-slate-700/50">
                        <span class="text-slate-400 text-xs">Status</span>
                        <span id="statusBadge" class="status-badge status-ready">Ready</span>
                    </div>
                    <label class="flex items-center gap-2 text-xs text-slate-400 cursor-pointer mt-2">
                        <input type="checkbox" id="audioToggle" class="w-3 h-3 rounded">
                        <span>üîä Audio</span>
                    </label>
                </div>

                <div class="glass-card rounded-xl p-3">
                    <h2 class="text-xs font-semibold mb-2 text-slate-300">Distances</h2>
                    <div id="distTable" class="dist-table"></div>
                </div>

                <div class="glass-card rounded-xl p-3">
                    <h2 class="text-xs font-semibold mb-2 text-slate-300">Algorithm</h2>
                    <div class="code-panel bg-slate-900/50 rounded-lg p-2">
                        <div class="code-line" data-line="1"><span class="code-line-number">1</span>dist[src] = 0</div>
                        <div class="code-line" data-line="2"><span class="code-line-number">2</span>pq.insert(src, 0)
                        </div>
                        <div class="code-line" data-line="3"><span class="code-line-number">3</span><span
                                class="text-purple-400">while</span> !pq.empty():</div>
                        <div class="code-line" data-line="4"><span class="code-line-number">4</span> u = pq.extractMin()
                        </div>
                        <div class="code-line" data-line="5"><span class="code-line-number">5</span> <span
                                class="text-purple-400">for</span> (v,w) in adj[u]:</div>
                        <div class="code-line" data-line="6"><span class="code-line-number">6</span> <span
                                class="text-purple-400">if</span> dist[u]+w < dist[v]:</div>
                                <div class="code-line" data-line="7"><span class="code-line-number">7</span> dist[v] =
                                    dist[u]+w</div>
                                <div class="code-line" data-line="8"><span class="code-line-number">8</span>
                                    pq.update(v, dist[v])</div>
                        </div>
                    </div>

                    <div class="glass-card rounded-xl p-3">
                        <h2 class="text-xs font-semibold mb-2 text-slate-300">Metrics</h2>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="metric">
                                <div class="text-xs text-slate-400">Relaxations</div>
                                <div class="metric-value text-blue-400" id="relaxations">0</div>
                            </div>
                            <div class="metric">
                                <div class="text-xs text-slate-400">Processed</div>
                                <div class="metric-value text-green-400" id="processed">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-8">
                    <div class="glass-card rounded-xl p-4">
                        <h3 class="text-xs font-semibold text-slate-300 mb-2">Weighted Graph</h3>
                        <div id="graphContainer" class="graph-container"></div>
                        <div id="stepInfo" class="mt-2 text-center text-xs text-slate-400 font-mono"></div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const graph = {
                A: [['B', 4], ['C', 2]],
                B: [['A', 4], ['C', 1], ['D', 5]],
                C: [['A', 2], ['B', 1], ['D', 8], ['E', 10]],
                D: [['B', 5], ['C', 8], ['E', 2]],
                E: [['C', 10], ['D', 2]]
            };

            const nodePositions = {
                A: { x: 60, y: 160 },
                B: { x: 200, y: 60 },
                C: { x: 200, y: 260 },
                D: { x: 380, y: 100 },
                E: { x: 450, y: 240 }
            };

            let nodes = {}, edgeElements = {}, dist = {}, prev = {}, processed = new Set();
            let stateStack = [], currentStateIndex = -1;
            let isPlaying = false, isPaused = false, isRunning = false, speed = 1;
            let relaxCount = 0, processedCount = 0, audioEnabled = false, audioCtx = null;

            function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
            function playTone(freq, dur, type = 'sine') {
                if (!audioEnabled || !audioCtx) return;
                const o = audioCtx.createOscillator(), g = audioCtx.createGain();
                o.connect(g); g.connect(audioCtx.destination);
                o.frequency.value = freq; o.type = type;
                g.gain.setValueAtTime(0.08, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
                o.start(); o.stop(audioCtx.currentTime + dur);
            }
            const sounds = { extract: () => playTone(500, 0.08), relax: () => playTone(600, 0.06), update: () => playTone(700, 0.08), done: () => playTone(800, 0.15) };

            const container = document.getElementById('graphContainer');
            const distTable = document.getElementById('distTable');
            const speedSlider = document.getElementById('speedSlider'), speedValue = document.getElementById('speedValue');
            const sourceNodeSelect = document.getElementById('sourceNode');
            const statusBadge = document.getElementById('statusBadge');
            const relaxationsEl = document.getElementById('relaxations'), processedEl = document.getElementById('processed');
            const stepInfo = document.getElementById('stepInfo');
            const playIcon = document.getElementById('playIcon'), pauseIcon = document.getElementById('pauseIcon');
            const stepBackBtn = document.getElementById('stepBackBtn'), stepForwardBtn = document.getElementById('stepForwardBtn');
            const audioToggle = document.getElementById('audioToggle');

            speedSlider.addEventListener('input', e => { speed = parseFloat(e.target.value); speedValue.textContent = speed + 'x'; });
            audioToggle.addEventListener('change', e => { audioEnabled = e.target.checked; if (audioEnabled) initAudio(); });

            function setStatus(s) {
                statusBadge.className = 'status-badge';
                statusBadge.classList.add(s === 'Ready' ? 'status-ready' : s === 'Running' ? 'status-running' : s === 'Paused' ? 'status-paused' : 'status-complete');
                statusBadge.textContent = s === 'Running' ? 'Running...' : s;
            }

            function highlightCode(line) {
                document.querySelectorAll('.code-line').forEach(el => el.classList.remove('active'));
                if (line) document.querySelector(`.code-line[data-line="${line}"]`)?.classList.add('active');
            }

            function drawEdge(from, to, weight) {
                const p1 = nodePositions[from], p2 = nodePositions[to];
                const dx = p2.x - p1.x, dy = p2.y - p1.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                const edge = document.createElement('div');
                edge.className = 'edge';
                edge.id = `edge-${from}-${to}`;
                edge.style.width = `${length - 52}px`;
                edge.style.left = `${p1.x + 26}px`;
                edge.style.top = `${p1.y + 26}px`;
                edge.style.transform = `rotate(${angle}deg)`;
                container.appendChild(edge);

                const weightLabel = document.createElement('div');
                weightLabel.className = 'edge-weight';
                weightLabel.textContent = weight;
                weightLabel.style.left = `${(p1.x + p2.x) / 2 + 26}px`;
                weightLabel.style.top = `${(p1.y + p2.y) / 2 + 26}px`;
                container.appendChild(weightLabel);

                edgeElements[`${from}-${to}`] = edge;
            }

            function initGraph() {
                container.innerHTML = '';
                edgeElements = {};
                const drawn = new Set();

                for (const node in graph) {
                    for (const [neighbor, weight] of graph[node]) {
                        const key = [node, neighbor].sort().join('-');
                        if (!drawn.has(key)) {
                            drawEdge(node, neighbor, weight);
                            drawn.add(key);
                        }
                    }
                }

                for (const node in nodePositions) {
                    const el = document.createElement('div');
                    el.className = 'node node-idle';
                    el.innerHTML = `<span class="node-label">${node}</span><span class="node-dist">‚àû</span>`;
                    el.style.left = `${nodePositions[node].x}px`;
                    el.style.top = `${nodePositions[node].y}px`;
                    container.appendChild(el);
                    nodes[node] = el;
                }
            }

            function updateDistTable(current = null) {
                distTable.innerHTML = Object.keys(dist).map(n =>
                    `<div class="dist-row ${n === current ? 'current' : ''}">
                    <span class="dist-node">${n}</span>
                    <span class="${dist[n] === Infinity ? 'dist-inf' : 'dist-val'}">${dist[n] === Infinity ? '‚àû' : dist[n]}</span>
                </div>`
                ).join('');
            }

            function updateNodeDist(node) {
                const distEl = nodes[node].querySelector('.node-dist');
                distEl.textContent = dist[node] === Infinity ? '‚àû' : dist[node];
            }

            function resetGraph() {
                if (isRunning) return;
                dist = {}; prev = {}; processed.clear();
                relaxCount = 0; processedCount = 0;
                relaxationsEl.textContent = '0'; processedEl.textContent = '0';
                stateStack = []; currentStateIndex = -1;
                stepInfo.textContent = ''; highlightCode(null);

                for (const node in nodes) {
                    nodes[node].className = 'node node-idle';
                    nodes[node].querySelector('.node-dist').textContent = '‚àû';
                    dist[node] = Infinity;
                }
                for (const key in edgeElements) edgeElements[key].className = 'edge';
                updateDistTable();
                setStatus('Ready'); updatePlayPauseBtn(); stepBackBtn.disabled = true; stepForwardBtn.disabled = true;
            }

            function captureState(info, codeLine) {
                const state = { dist: { ...dist }, processed: new Set(processed), nodeClasses: {}, edgeClasses: {}, info, codeLine, relaxCount, processedCount };
                for (const n in nodes) state.nodeClasses[n] = nodes[n].className;
                for (const k in edgeElements) state.edgeClasses[k] = edgeElements[k].className;
                if (currentStateIndex < stateStack.length - 1) stateStack = stateStack.slice(0, currentStateIndex + 1);
                stateStack.push(state); currentStateIndex = stateStack.length - 1;
            }

            function restoreState(idx) {
                if (idx < 0 || idx >= stateStack.length) return;
                const s = stateStack[idx];
                dist = { ...s.dist }; processed = new Set(s.processed);
                for (const n in nodes) { nodes[n].className = s.nodeClasses[n]; updateNodeDist(n); }
                for (const k in edgeElements) edgeElements[k].className = s.edgeClasses[k];
                relaxCount = s.relaxCount; processedCount = s.processedCount;
                relaxationsEl.textContent = relaxCount; processedEl.textContent = processedCount;
                updateDistTable();
                stepInfo.textContent = s.info; highlightCode(s.codeLine);
                currentStateIndex = idx;
                stepBackBtn.disabled = currentStateIndex <= 0;
                stepForwardBtn.disabled = currentStateIndex >= stateStack.length - 1;
            }

            function stepBack() { if (currentStateIndex > 0) { isPaused = true; setStatus('Paused'); restoreState(currentStateIndex - 1); } }
            function stepForward() { if (currentStateIndex < stateStack.length - 1) restoreState(currentStateIndex + 1); }

            function updatePlayPauseBtn() {
                if (isPlaying) { playIcon.classList.add('hidden'); pauseIcon.classList.remove('hidden'); document.getElementById('playPauseBtn').classList.replace('btn-play', 'btn-pause'); }
                else { playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); document.getElementById('playPauseBtn').classList.replace('btn-pause', 'btn-play'); }
            }

            async function togglePlayPause() {
                if (!isRunning) startDijkstra();
                else if (isPlaying) { isPlaying = false; isPaused = true; setStatus('Paused'); updatePlayPauseBtn(); }
                else { isPlaying = true; isPaused = false; setStatus('Running'); updatePlayPauseBtn(); }
            }

            function sleep(ms) { return new Promise(r => { const check = () => { if (!isPaused) r(); else setTimeout(check, 50); }; setTimeout(check, ms / speed); }); }
            async function waitIfPaused() { while (isPaused && isRunning) await new Promise(r => setTimeout(r, 50)); }

            async function startDijkstra() {
                isRunning = true; isPlaying = true; isPaused = false;
                stateStack = []; currentStateIndex = -1;
                resetGraph();
                setStatus('Running'); updatePlayPauseBtn();
                stepBackBtn.disabled = false; stepForwardBtn.disabled = true;

                const source = sourceNodeSelect.value;
                dist[source] = 0;
                nodes[source].className = 'node node-source';
                updateNodeDist(source);
                updateDistTable();
                highlightCode(1);
                captureState(`Initialize dist[${source}] = 0`, 1);
                await sleep(500);

                // Priority queue (simple array)
                let pq = [[source, 0]];
                highlightCode(2);
                captureState(`Insert ${source} into priority queue`, 2);
                await sleep(400);

                while (pq.length > 0) {
                    await waitIfPaused();
                    highlightCode(3);

                    // Extract min
                    pq.sort((a, b) => a[1] - b[1]);
                    const [u, d] = pq.shift();

                    if (processed.has(u)) continue;

                    nodes[u].className = 'node node-current';
                    sounds.extract();
                    highlightCode(4);
                    stepInfo.textContent = `Extract min: ${u} (dist=${d})`;
                    captureState(`Extract ${u} with dist=${d}`, 4);
                    await sleep(500);

                    processed.add(u);
                    processedCount++; processedEl.textContent = processedCount;
                    updateDistTable(u);

                    // Relax neighbors
                    highlightCode(5);
                    for (const [v, weight] of graph[u]) {
                        await waitIfPaused();

                        if (processed.has(v)) continue;

                        nodes[v].className = 'node node-queue';
                        const edgeKey = edgeElements[`${u}-${v}`] ? `${u}-${v}` : `${v}-${u}`;
                        edgeElements[edgeKey].className = 'edge edge-relaxed';

                        highlightCode(6);
                        sounds.relax();
                        stepInfo.textContent = `Check: dist[${u}](${dist[u]}) + ${weight} < dist[${v}](${dist[v] === Infinity ? '‚àû' : dist[v]})?`;
                        captureState(`Relax edge (${u}, ${v}, ${weight})`, 6);
                        await sleep(400);

                        if (dist[u] + weight < dist[v]) {
                            dist[v] = dist[u] + weight;
                            prev[v] = u;
                            updateNodeDist(v);
                            updateDistTable(u);

                            pq.push([v, dist[v]]);
                            relaxCount++; relaxationsEl.textContent = relaxCount;
                            sounds.update();
                            highlightCode(7);
                            stepInfo.textContent = `Update: dist[${v}] = ${dist[v]}`;
                            captureState(`dist[${v}] = ${dist[v]}`, 7);
                            await sleep(400);
                            highlightCode(8);
                            await sleep(200);
                        }

                        if (!processed.has(v)) nodes[v].className = 'node node-idle';
                        edgeElements[edgeKey].className = 'edge';
                    }

                    nodes[u].className = 'node node-done';
                    captureState(`${u} processed`, 4);
                    await sleep(300);
                }

                // Mark shortest path edges
                for (const v in prev) {
                    const u = prev[v];
                    const edgeKey = edgeElements[`${u}-${v}`] ? `${u}-${v}` : `${v}-${u}`;
                    edgeElements[edgeKey].className = 'edge edge-shortest';
                }

                sounds.done();
                setStatus('Complete');
                stepInfo.textContent = 'Dijkstra Complete!';
                captureState('Dijkstra Complete!', null);
                isRunning = false; isPlaying = false; updatePlayPauseBtn(); highlightCode(null);
            }

            initGraph();
            resetGraph();
        </script>
</body>

</html>